Role: Senior Backend & Full Stack Developer  
Project: SPECTROPY PMS  
Feature: Task Stages + Automatic Next-Stage Task Creation  

---

## üéØ OBJECTIVE

Define and enforce a **3-stage task workflow** and implement **automatic task creation in the next stage**.

---

## üß© TASK STAGES (STRICT)

Every task must follow **ONLY these three stages**:

1. **To Do**
2. **In Progress**
3. **Completed**

No other stages are allowed for now.

Each stage corresponds to a **bucket** in the Kanban board.

---

## üîÑ AUTOMATIC TASK PROGRESSION RULE

When a task is marked as **Completed**:

1. Identify the **current stage** of the task.
2. Determine the **next stage** based on the order:
   ```
   To Do ‚Üí In Progress ‚Üí Completed
   ```
3. If a **next stage exists**, automatically create a **new task** in that next stage.

---

## üß† PROGRESSION LOGIC DETAILS

### Case 1: Task in `To Do`
- When marked **Completed**
- Auto-create the same task in **In Progress**

### Case 2: Task in `In Progress`
- When marked **Completed**
- Auto-create the same task in **Completed**

### Case 3: Task in `Completed`
- When marked **Completed**
- ‚ùå Do nothing (end of flow)

---

## üóÇÔ∏è BACKEND IMPLEMENTATION (MANDATORY)

### Update Endpoint:
```
PATCH /api/tasks/:id
```

Trigger auto-creation **ONLY when**:
- `status` changes to `"completed"`

### New Task Creation Rules:

#### Copy these fields:
- title
- description
- priority
- assigned users
- checklist
- attachments
- projectId

#### DO NOT COPY (MUST BE EMPTY):
- startDate
- endDate
- estimateHours
- estimateMinutes

#### Set:
- status = `"todo"`
- bucketId = next stage bucket
- position = last position in that bucket + 1

---

## üïí TASK HISTORY (REQUIRED)

Append history logs automatically:

### Original Task:
```
"Task completed in <Current Stage> on <date>"
```

### Auto-Created Task:
```
"Auto-created from <Previous Stage> on <date>"
```

History must be stored backend-side and must not be editable from frontend.

---

## üñ•Ô∏è FRONTEND RESPONSIBILITY (LIMITED)

- Frontend should ONLY:
  - Mark task as completed
  - Call PATCH API
  - Refetch tasks

- Frontend must NOT:
  - Manually create the next task
  - Handle stage logic

---

## ‚ö†Ô∏è IMPORTANT RULES

| Rule | Requirement |
|----|----|
| Source of Truth | Backend only |
| Duplicate Tasks | Must not create multiple tasks on repeated calls |
| Date & Time | Must be empty in auto-created task |
| Permissions | Only assigned users or admin can complete |
| Final Stage | No auto-creation after Completed |

---

## ‚úÖ EXPECTED RESULT

- Tasks move logically through:
  ```
  To Do ‚Üí In Progress ‚Üí Completed
  ```
- Each completion creates the task in the next stage
- Behavior matches **Microsoft Planner-style task flow**
- Clean, predictable Kanban behavior

---

Proceed to implement and confirm once completed.
